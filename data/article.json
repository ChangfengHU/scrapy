[{"url": "http://python.jobbole.com/89209/", "url_object_id": "52d78ed405be478c2f0eb48505c313cb", "front_image_url": ["http://wx1.sinaimg.cn/mw690/7cc829d3gy1ft3v251rd9j21hc0u0qv3.jpg"], "title": "用 Python 分析了 20 万场吃鸡数据_scrapy", "create_date": "2019-01-20", "praise_nums": 3, "comment_nums": 6, "fav_nums": 13, "tags": "实践项目,,吃鸡数据", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/wx4134404245\">张波</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>首先，神枪镇楼</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/65f1a9afbe5e94cf8034258fa24455c4.jpg\"><img class=\"aligncenter size-full wp-image-89211\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/65f1a9afbe5e94cf8034258fa24455c4.jpg\" alt=\"15310635540917\"></a></p>\n<h1>背景</h1>\n<p>最近老板爱上了吃鸡（手游：全军出击），经常拉着我们开黑，只能放弃午休的时间，陪老板在沙漠里奔波。 上周在在微信游戏频道看战绩的时候突发奇想，是不是可以通过这个方式抓取到很多战斗数据，然后分析看看有什么规律。 <a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/80dfd2d4ceb291cae79733a94e6b7b1b.jpg\"><img class=\"aligncenter size-full wp-image-89220\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/80dfd2d4ceb291cae79733a94e6b7b1b.jpg\" alt=\"15311076652700\"></a></p>\n<blockquote><p>秀一波战绩，开黑情况下我们团队吃鸡率非常高，近100场吃鸡次数51次</p></blockquote>\n<p>简单评估了一下，觉得可行，咱就开始。</p>\n<h1 id=\"toc_2\">Step 1 分析数据接口</h1>\n<p>第一步当然是把这些战绩数据采集下来，首先我们需要了解页面背后的故事。去看看页面是如何获取战斗数据的。</p>\n<h2 id=\"toc_3\">使用Charles抓包</h2>\n<h3 id=\"toc_4\">抓包实现</h3>\n<p>在Mac下推荐使用工具Charles来从协议层抓取手机上的流量，原理就是在Mac上开启一个代理服务器，然后将手机的网络代理设置为Mac，这样手机上的所有流量都会经过我们的代理服务器了。 大致流程如下： <a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/2be314182fc9c6908f9edfa5951c0ea7.jpg\"><img class=\"aligncenter size-full wp-image-89221\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/2be314182fc9c6908f9edfa5951c0ea7.jpg\" alt=\"1\"></a></p>\n<h3 id=\"toc_5\">https加密流量的处理</h3>\n<p>在实际操作的时候发现微信所有的流量都走了HTTPS，导致我们的抓到的都是加密数据，对我们没有任何参考意义。 经过研究，可以通过在手机和电脑都安装Charles根证书的方式来实现对Https流量的分析，具体操作可以参考：</p>\n<ul>\n<li><a href=\"https://blog.csdn.net/qq_30259339/article/details/53981448\">charles mac下https抓包和iphone https抓包</a></li>\n<li><a href=\"https://www.jianshu.com/p/4005cf4f370d\">解决Charles无法正常抓包iOS 11中的Https请求</a></li>\n</ul>\n<p>安装证书后，我们的流量大致是这样子的 <a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/68a0af17ae306f5a94291c9f306422ae.jpg\"><img class=\"aligncenter size-full wp-image-89222\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/68a0af17ae306f5a94291c9f306422ae.jpg\" alt=\"1\"></a> 经过上述的配置，我们已经可以读取到https的请求和响应数据了，如下图所示。 <a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/8105cb0115a64f721e0e70d926b111c6.jpg\"><img class=\"aligncenter size-full wp-image-89212\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/8105cb0115a64f721e0e70d926b111c6.jpg\" alt=\"15310659449947\"></a></p>\n<blockquote>\n<ul>\n<li>windows下用findler可以实现相同的功能</li>\n<li>其实这就是一个非常典型的中间人场景</li>\n</ul>\n</blockquote>\n<h3 id=\"toc_6\">数据接口</h3>\n<p>接下来就根据这些数据来找出我们需要的接口了，经过分析，主要涉及三个接口</p>\n<ul>\n<li>获取用户信息接口</li>\n<li>获取用户战绩列表接口</li>\n<li>获取用户指定战绩详细信息接口</li>\n</ul>\n<p>下面我们一个一个看</p>\n<h4 id=\"toc_7\">1. 获取用户信息接口</h4>\n<ul>\n<li>request</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>API</th>\n<th>/cgi-bin/gamewap/getpubgmbattlelist</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>方法</td>\n<td>GET</td>\n</tr>\n<tr>\n<td>参数</td>\n<td>openid、pass_ticket、plat_id、after_time、limit</td>\n</tr>\n<tr>\n<td>cookie</td>\n<td>key pass_ticket、uin、pgv_pvid、sd_cookie_crttime、sd_userid</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>response</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5c43759c4d6f4965798985\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n    \"user_info\": {\r\n        \"openid\": \"oODfo0pjBQkcNuR4XLTQ321xFVws\",\r\n        \"head_img_url\": \"http://wx.qlogo.cn/mmhead/Q3auHgzwzM5hSWxxxxxUQPwW9ibxxxx9DlxLTsKWk97oWpDI0rg/96\",\r\n        \"nick_name\": \"望\",\r\n        \"role_name\": \"xxxx\",\r\n        \"zone_area_id\": 0,\r\n        \"plat_id\": 1\r\n    },\r\n    \"battle_info\": {\r\n        \"total_1\": 75,\r\n        \"total_10\": 336,\r\n        \"total_game\": 745,\r\n        \"total_kill\": 1669\r\n    },\r\n    \"battle_list\": [{\r\n        \"map_id\": 1,\r\n        \"room_id\": \"6575389198189071197\",\r\n        \"team_id\": 57,\r\n        \"dt_event_time\": 1530953799,\r\n        \"rank_in_ds\": 3,\r\n        \"times_kill\": 1,\r\n        \"label\": \"前五\",\r\n        \"team_type\": 1,\r\n        \"award_gold\": 677,\r\n        \"mode\": 0\r\n    }],\r\n    \"appitem\": {\r\n        \"AppID\": \"wx13051697527efc45\",\r\n        \"IconURL\": \"https://mmocgame.qpic.cn/wechatgame/mEMdfrX5RU0dZFfNEdCsMJpfsof1HE0TP3cfZiboX0ZPxqh5aZnHjxPFXUGgsXmibe/0\",\r\n        \"Name\": \"绝地求生 全军出击\",\r\n        \"BriefName\": \"绝地求生 全军出击\",\r\n        \"Desc\": \"官方正版绝地求生手游\",\r\n        \"Brief\": \"枪战 | 808.2M\",\r\n        \"WebURL\": \"https://game.weixin.qq.com/cgi-bin/h5/static/detail_v2/index.html?wechat_pkgid=detail_v2&amp;appid=wx13051697527efc45&amp;show_bubble=0\",\r\n        \"DownloadInfo\": {\r\n            \"DownloadURL\": \"https://itunes.apple.com/cn/app/id1304987143\",\r\n            \"DownloadFlag\": 5\r\n        },\r\n        \"Status\": 0,\r\n        \"AppInfoFlag\": 45,\r\n        \"Label\": [],\r\n        \"AppStorePopUpDialogConfig\": {\r\n            \"Duration\": 1500,\r\n            \"Interval\": 172800,\r\n            \"ServerTimestamp\": 1531066098\r\n        },\r\n        \"HasEnabledChatGroup\": false,\r\n        \"AppType\": 0,\r\n        \"game_tag_list\": [\"绝地求生\", \"正版还原\", \"好友开黑\", \"百人对战\", \"超大地图\"],\r\n        \"recommend_reason\": \"正版绝地求生，荒野射击\",\r\n        \"size_desc\": \"808.2M\"\r\n    },\r\n    \"is_guest\": true,\r\n    \"is_blocked\": false,\r\n    \"errcode\": 0,\r\n    \"errmsg\": \"ok\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d6f4965798985-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d6f4965798985-58\">58</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"user_info\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"openid\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"oODfo0pjBQkcNuR4XLTQ321xFVws\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"head_img_url\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://wx.qlogo.cn/mmhead/Q3auHgzwzM5hSWxxxxxUQPwW9ibxxxx9DlxLTsKWk97oWpDI0rg/96\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"nick_name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"望\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"role_name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"xxxx\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"zone_area_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"plat_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"battle_info\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"total_1\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">75</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"total_10\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">336</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"total_game\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">745</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"total_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1669</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"battle_list\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"map_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"room_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6575389198189071197\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"team_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">57</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"dt_event_time\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1530953799</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"rank_in_ds\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"times_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"label\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"前五\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"team_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"award_gold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">677</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"mode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"appitem\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"AppID\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"wx13051697527efc45\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"IconURL\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://mmocgame.qpic.cn/wechatgame/mEMdfrX5RU0dZFfNEdCsMJpfsof1HE0TP3cfZiboX0ZPxqh5aZnHjxPFXUGgsXmibe/0\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"绝地求生 全军出击\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"BriefName\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"绝地求生 全军出击\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Desc\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"官方正版绝地求生手游\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Brief\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"枪战 | 808.2M\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"WebURL\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://game.weixin.qq.com/cgi-bin/h5/static/detail_v2/index.html?wechat_pkgid=detail_v2&amp;appid=wx13051697527efc45&amp;show_bubble=0\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"DownloadInfo\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"DownloadURL\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://itunes.apple.com/cn/app/id1304987143\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"DownloadFlag\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Status\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"AppInfoFlag\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Label\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"AppStorePopUpDialogConfig\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"Duration\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1500</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"Interval\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172800</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"ServerTimestamp\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1531066098</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"HasEnabledChatGroup\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"AppType\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"game_tag_list\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"绝地求生\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"正版还原\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"好友开黑\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"百人对战\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"超大地图\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"recommend_reason\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"正版绝地求生，荒野射击\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"size_desc\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"808.2M\"</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"is_guest\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"is_blocked\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"errcode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d6f4965798985-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"errmsg\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ok\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d6f4965798985-58\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0068 seconds] -->\r\n<p></p>\n<h4 id=\"toc_8\">2. 获取用户战绩列表接口</h4>\n<ul>\n<li>分析</li>\n</ul>\n<p>openid是用户的惟一标识。</p>\n<h3 id=\"toc_8\">2. 获取用户战绩列表接口</h3>\n<ul>\n<li>request<br>\n<table>\n<thead>\n<tr>\n<th>API</th>\n<th>/cgi-bin/gamewap/getpubgmbattlelist</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>方法</td>\n<td>GET</td>\n</tr>\n<tr>\n<td>参数</td>\n<td>openid、pass_ticket、plat_id、after_time、limit</td>\n</tr>\n<tr>\n<td>cookie</td>\n<td>key pass_ticket、uin、pgv_pvid、sd_cookie_crttime、sd_userid</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>response</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5c43759c4d700876743015\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n\"errcode\": 0,\r\n\"errmsg\": \"ok\",\r\n\"next_after_time\": 1528120556,\r\n\"battle_list\": [{\r\n    \"map_id\": 1,\r\n    \"room_id\": \"6575389198111172597\",\r\n    \"team_id\": 57,\r\n    \"dt_event_time\": 1530953799,\r\n    \"rank_in_ds\": 3,\r\n    \"times_kill\": 1,\r\n    \"label\": \"前五\",\r\n    \"team_type\": 1,\r\n    \"award_gold\": 677,\r\n    \"mode\": 0\r\n}, {\r\n    \"map_id\": 1,\r\n    \"room_id\": \"6575336498940384115\",\r\n    \"team_id\": 11,\r\n    \"dt_event_time\": 1530941404,\r\n    \"rank_in_ds\": 5,\r\n    \"times_kill\": 2,\r\n    \"label\": \"前五\",\r\n    \"team_type\": 1,\r\n    \"award_gold\": 632,\r\n    \"mode\": 0\r\n}],\r\n\"has_next\": true\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d700876743015-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d700876743015-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-2\"><span class=\"crayon-s\">\"errcode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-3\"><span class=\"crayon-s\">\"errmsg\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ok\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-4\"><span class=\"crayon-s\">\"next_after_time\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1528120556</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-5\"><span class=\"crayon-s\">\"battle_list\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"map_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"room_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6575389198111172597\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"team_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">57</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"dt_event_time\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1530953799</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"rank_in_ds\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"label\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"前五\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"team_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"award_gold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">677</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"mode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-16\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"map_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"room_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6575336498940384115\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"team_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"dt_event_time\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1530941404</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"rank_in_ds\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"label\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"前五\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"team_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"award_gold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">632</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"mode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-27\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d700876743015-28\"><span class=\"crayon-s\">\"has_next\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d700876743015-29\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p></p>\n<ul>\n<li>分析</li>\n<li>这个接口用after_time来进行分页，遍历获取时可以根据接口响应的has_next和next_after_time来判断是否还有下一页的数据。</li>\n<li>列表里面的room_id是每一场battle的惟一标识。</li>\n</ul>\n<h4 id=\"toc_9\">3. 获取用户战绩详情接口</h4>\n<ul>\n<li>request</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>API</th>\n<th>/cgi-bin/gamewap/getpubgmbattledetail</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>方法</td>\n<td>GET</td>\n</tr>\n<tr>\n<td>参数</td>\n<td>openid、pass_ticket、room_id</td>\n</tr>\n<tr>\n<td>cookie</td>\n<td>key pass_ticket、uin、pgv_pvid、sd_cookie_crttime、sd_userid</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>request</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5c43759c4d705585134308\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n\"errcode\": 0,\r\n\"errmsg\": \"ok\",\r\n\"base_info\": {\r\n    \"nick_name\": \"柚茶\",\r\n    \"head_img_url\": \"http://wx.qlogo.cn/mmhead/xxxx/96\",\r\n    \"dt_event_time\": 1528648165,\r\n    \"team_type\": 4,\r\n    \"rank\": 1,\r\n    \"player_count\": 100,\r\n    \"role_sex\": 1,\r\n    \"label\": \"大吉大利\",\r\n    \"openid\": \"oODfo0s1w5lWjmxxxxxgQkcCljXQ\"\r\n},\r\n\"battle_info\": {\r\n    \"award_gold\": 622,\r\n    \"times_kill\": 6,\r\n    \"times_head_shot\": 0,\r\n    \"damage\": 537,\r\n    \"times_assist\": 3,\r\n    \"survival_duration\": 1629,\r\n    \"times_save\": 0,\r\n    \"times_reborn\": 0,\r\n    \"vehicle_kill\": 1,\r\n    \"forward_distance\": 10140,\r\n    \"driving_distance\": 5934,\r\n    \"dead_poison_circle_no\": 6,\r\n    \"top_kill_distance\": 223,\r\n    \"top_kill_distance_weapon_use\": 2924130819,\r\n    \"be_kill_user\": {\r\n        \"nick_name\": \"小旭\",\r\n        \"head_img_url\": \"http://wx.qlogo.cn/mmhead/ibLButGMnqJNFsUtStNEV8tzlH1QpwPiaF9kxxxxx66G3ibjic6Ng2Rcg/96\",\r\n        \"weapon_use\": 20101000001,\r\n        \"openid\": \"oODfo0qrPLExxxxc0QKjFPnPxyI\"\r\n    },\r\n    \"label\": \"大吉大利\"\r\n},\r\n\"team_info\": {\r\n    \"user_list\": [{\r\n        \"nick_name\": \"ooo\",\r\n        \"times_kill\": 6,\r\n        \"assist_count\": 3,\r\n        \"survival_duration\": 1638,\r\n        \"award_gold\": 632,\r\n        \"head_img_url\": \"http://wx.qlogo.cn/mmhead/Q3auHgzwzM4k4RXdyxavNxxxxUjcX6Tl47MNNV1dZDliazRKRg\",\r\n        \"openid\": \"oODfo0xxxxf1bRAXE-q-lEezK0k\"\r\n    }, {\r\n        \"nick_name\": \"我吃炒肉\",\r\n        \"times_kill\": 2,\r\n        \"assist_count\": 2,\r\n        \"survival_duration\": 1502,\r\n        \"award_gold\": 583,\r\n        \"head_img_url\": \"http://wx.qlogo.cn/mmhead/sTJptKvBQLKd5SAAjOF0VrwiapUxxxxFffxoDUcrVjYbDf9pNENQ\",\r\n        \"openid\": \"oODfo0gIyDxxxxZpUrSrpapZSDT0\"\r\n    }]\r\n},\r\n\"is_guest\": true,\r\n\"is_blocked\": false\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d705585134308-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d705585134308-59\">59</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-2\"><span class=\"crayon-s\">\"errcode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-3\"><span class=\"crayon-s\">\"errmsg\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ok\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-4\"><span class=\"crayon-s\">\"base_info\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"nick_name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"柚茶\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"head_img_url\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://wx.qlogo.cn/mmhead/xxxx/96\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"dt_event_time\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1528648165</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"team_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"rank\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"player_count\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"role_sex\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"label\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"大吉大利\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"openid\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"oODfo0s1w5lWjmxxxxxgQkcCljXQ\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-14\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-15\"><span class=\"crayon-s\">\"battle_info\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"award_gold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">622</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_head_shot\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"damage\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">537</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_assist\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"survival_duration\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1629</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_save\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_reborn\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"vehicle_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"forward_distance\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10140</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"driving_distance\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5934</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"dead_poison_circle_no\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"top_kill_distance\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">223</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"top_kill_distance_weapon_use\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2924130819</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"be_kill_user\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"nick_name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"小旭\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"head_img_url\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://wx.qlogo.cn/mmhead/ibLButGMnqJNFsUtStNEV8tzlH1QpwPiaF9kxxxxx66G3ibjic6Ng2Rcg/96\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"weapon_use\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20101000001</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"openid\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"oODfo0qrPLExxxxc0QKjFPnPxyI\"</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"label\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"大吉大利\"</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-37\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-38\"><span class=\"crayon-s\">\"team_info\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"user_list\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"nick_name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ooo\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"times_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"assist_count\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"survival_duration\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1638</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"award_gold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">632</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"head_img_url\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://wx.qlogo.cn/mmhead/Q3auHgzwzM4k4RXdyxavNxxxxUjcX6Tl47MNNV1dZDliazRKRg\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"openid\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"oODfo0xxxxf1bRAXE-q-lEezK0k\"</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"nick_name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"我吃炒肉\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"times_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"assist_count\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"survival_duration\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1502</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"award_gold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">583</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"head_img_url\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://wx.qlogo.cn/mmhead/sTJptKvBQLKd5SAAjOF0VrwiapUxxxxFffxoDUcrVjYbDf9pNENQ\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"openid\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"oODfo0gIyDxxxxZpUrSrpapZSDT0\"</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-56\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-57\"><span class=\"crayon-s\">\"is_guest\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d705585134308-58\"><span class=\"crayon-s\">\"is_blocked\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d705585134308-59\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0067 seconds] -->\r\n<p></p>\n<ul>\n<li>分析</li>\n<li>这个接口响应了战斗的详细信息，包括杀人数、爆头数、救人数、跑动距离等等，足够我们分析了。</li>\n<li>这个接口还响应了是被谁杀死的以及组团成员的openid，利用这个特性我们这可无限深度的发散爬取更多用户的数据。</li>\n</ul>\n<p>至于cookie中的息pass_ticket等信息肯定是用于权限认证的，在上述的几次请求中这些信息都没有变化，所以我们不需要深研其是怎么算出来的，只需要抓包提取到默认信息后填到代码里面就可以用了。</p>\n<h1 id=\"toc_10\">Step 2 爬取数据</h1>\n<p>接口已经确定下来了，接下来就是去抓取足够量的数据了。</p>\n<h2 id=\"toc_11\">使用requests请求接口获取数据</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5c43759c4d70a297351238\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n url = 'https://game.weixin.qq.com/cgi-bin/gamewap/getpubgmdatacenterindex?openid=%s&amp;plat_id=0&amp;uin=&amp;key=&amp;pass_ticket=%s' % (openid, settings.pass_ticket)\r\n    r = requests.get(url=url, cookies=settings.def_cookies, headers=settings.def_headers, timeout=(5.0, 5.0))\r\n    tmp = r.json()\r\n    wfile = os.path.join(settings.Res_UserInfo_Dir, '%s.txt' % (rediskeys.user(openid)))\r\n\r\n    with codecs.open(wfile, 'w', 'utf-8') as wf:\r\n        wf.write(simplejson.dumps(tmp, indent=2, sort_keys=True, ensure_ascii=False))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d70a297351238-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d70a297351238-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d70a297351238-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d70a297351238-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d70a297351238-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d70a297351238-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d70a297351238-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5c43759c4d70a297351238-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://game.weixin.qq.com/cgi-bin/gamewap/getpubgmdatacenterindex?openid=%s&amp;plat_id=0&amp;uin=&amp;key=&amp;pass_ticket=%s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pass_ticket</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d70a297351238-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cookies</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">def_cookies</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">def_headers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d70a297351238-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d70a297351238-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">wfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Res_UserInfo_Dir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%s.txt'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rediskeys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">user</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d70a297351238-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d70a297351238-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">codecs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wfile</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'w'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wf</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d70a297351238-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">simplejson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dumps</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indent</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sort_keys</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ensure_ascii</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>参照这种方式我们可以很快把另外两个接口写好。</p>\n<h2 id=\"toc_12\">使用redis来标记已经爬取过的信息</h2>\n<p>在上述接口中我们可能从用户A的入口进去找到用户B的openid，然后从用户B的入口进去又找到用户A的openid，为了避免重复采集，所以我们需要记录下哪些信息是我们采集过的。 核心代码片断</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5c43759c4d70e740865160\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# rediskeys.user_battle_list 根据openid获取存在redis中的key值\r\ndef user_battle_list(openid):\r\n    return 'ubl_%s' % (openid)\r\n# 在提取battle list之前，首先判断这用用户的数据是否已经提取过了\r\nif settings.DataRedis.get(rediskeys.user_battle_list(openid)):\r\n        return True\r\n# 在提取battle list之后，需要在redis中记录用户信息\r\nsettings.DataRedis.set(rediskeys.user_battle_list(openid), 1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d70e740865160-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d70e740865160-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d70e740865160-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d70e740865160-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d70e740865160-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d70e740865160-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d70e740865160-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d70e740865160-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5c43759c4d70e740865160-1\"><span class=\"crayon-c\"># rediskeys.user_battle_list 根据openid获取存在redis中的key值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d70e740865160-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user_battle_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d70e740865160-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ubl_%s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d70e740865160-4\"><span class=\"crayon-c\"># 在提取battle list之前，首先判断这用用户的数据是否已经提取过了</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d70e740865160-5\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DataRedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rediskeys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">user_battle_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d70e740865160-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d70e740865160-7\"><span class=\"crayon-c\"># 在提取battle list之后，需要在redis中记录用户信息</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d70e740865160-8\"><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DataRedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rediskeys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">user_battle_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<h2 id=\"toc_13\">使用celery来管理队列</h2>\n<p>celery是一个非常好用的分布式队列管理工具，我这次只打算在我自己的电脑上运行，所以并没有用到分布式的功能。 我们创建三个task和三个queue</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5c43759c4d712135082089\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntask_queues = (\r\n    Queue('queue_get_battle_info', exchange=Exchange('priority', type='direct'), routing_key='gbi'),\r\n    Queue('queue_get_battle_list', exchange=Exchange('priority', type='direct'), routing_key='gbl'),\r\n    Queue('queue_get_user_info', exchange=Exchange('priority', type='direct'), routing_key='gui'),\r\n)\r\n\r\ntask_routes = ([\r\n    ('get_battle_info', {'queue': 'queue_get_battle_info'}),\r\n    ('get_battle_list', {'queue': 'queue_get_battle_list'}),\r\n    ('get_user_info', {'queue': 'queue_get_user_info'}),\r\n],)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d712135082089-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d712135082089-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d712135082089-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d712135082089-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d712135082089-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d712135082089-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d712135082089-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d712135082089-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d712135082089-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d712135082089-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d712135082089-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5c43759c4d712135082089-1\"><span class=\"crayon-v\">task_queues</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d712135082089-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'queue_get_battle_info'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exchange</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Exchange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'priority'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'direct'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routing_key</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'gbi'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d712135082089-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'queue_get_battle_list'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exchange</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Exchange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'priority'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'direct'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routing_key</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'gbl'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d712135082089-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'queue_get_user_info'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exchange</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Exchange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'priority'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'direct'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routing_key</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'gui'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d712135082089-5\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d712135082089-6\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d712135082089-7\"><span class=\"crayon-v\">task_routes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d712135082089-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'get_battle_info'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'queue'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'queue_get_battle_info'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d712135082089-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'get_battle_list'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'queue'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'queue_get_battle_list'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d712135082089-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'get_user_info'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'queue'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'queue_get_user_info'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d712135082089-11\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>然后在task中控制API请求和Redis数据实现完整的任务逻辑，如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5c43759c4d716027601334\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@app.task(name='get_battle_list')\r\ndef get_battle_list(openid, plat_id=None, after_time=0, update_time=None):\r\n    # 判断是否已经取过用户战绩列表信息\r\n    if settings.DataRedis.get(rediskeys.user_battle_list(openid)):\r\n        return True\r\n\r\n    if not plat_id:\r\n        try:\r\n            # 提取用户信息\r\n            us = handles.get_user_info_handles(openid)\r\n            plat_id=us['plat_id']\r\n        except Exception as e:\r\n            print 'can not get user plat_id', openid, traceback.format_exc()\r\n            return False\r\n    # 提取战绩列表\r\n    battle_list = handles.get_battle_list_handle(openid, plat_id, after_time=0, update_time=None)\r\n    \r\n    # 为每一场战斗创建异步获取详情任务\r\n    for room_id in battle_list:\r\n        if not settings.DataRedis.get(rediskeys.user_battle(openid, room_id)):\r\n            get_battle_info.delay(openid, plat_id, room_id)\r\n\r\n    return True</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d716027601334-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d716027601334-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d716027601334-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d716027601334-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d716027601334-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d716027601334-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d716027601334-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d716027601334-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d716027601334-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d716027601334-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d716027601334-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d716027601334-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d716027601334-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d716027601334-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d716027601334-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d716027601334-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d716027601334-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d716027601334-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d716027601334-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d716027601334-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d716027601334-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d716027601334-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d716027601334-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5c43759c4d716027601334-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">task</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'get_battle_list'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d716027601334-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_battle_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">plat_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">after_time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">update_time</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d716027601334-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 判断是否已经取过用户战绩列表信息</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d716027601334-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DataRedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rediskeys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">user_battle_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d716027601334-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d716027601334-6\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d716027601334-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">plat_id</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d716027601334-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d716027601334-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\"># 提取用户信息</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d716027601334-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">us</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handles</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_user_info_handles</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d716027601334-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">plat_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">us</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'plat_id'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d716027601334-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d716027601334-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'can not get user plat_id'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">traceback</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format_exc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d716027601334-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d716027601334-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 提取战绩列表</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d716027601334-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">battle_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handles</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_battle_list_handle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">plat_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">after_time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">update_time</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d716027601334-17\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d716027601334-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 为每一场战斗创建异步获取详情任务</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d716027601334-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">room_id </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_list</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d716027601334-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DataRedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rediskeys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">user_battle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">room_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d716027601334-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">get_battle_info</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">plat_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">room_id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d716027601334-22\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d716027601334-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0051 seconds] -->\r\n<p></p>\n<h2>开始抓取</h2>\n<p>因为我们是发散是爬虫，所以需要给代码一个用户的入口，所以需要手动创建一个用户的采集任务</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5c43759c4d71a305830972\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom tasks.all import get_battle_list\r\n\r\nmy_openid = 'oODfo0oIErZI2xxx9xPlVyQbRPgY'\r\nmy_platid = '0'\r\n\r\nget_battle_list.delay(my_openid, my_platid, after_time=0, update_time=None)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d71a305830972-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d71a305830972-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d71a305830972-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d71a305830972-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d71a305830972-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d71a305830972-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5c43759c4d71a305830972-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_battle_list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d71a305830972-2\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d71a305830972-3\"><span class=\"crayon-v\">my_openid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'oODfo0oIErZI2xxx9xPlVyQbRPgY'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d71a305830972-4\"><span class=\"crayon-v\">my_platid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d71a305830972-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d71a305830972-6\"><span class=\"crayon-v\">get_battle_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">my_openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">my_platid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">after_time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">update_time</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>有入口之后我们就用celery来启动worker去开始爬虫</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5c43759c4d71d554993428\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 启动获取用户详情worker\r\ncelery -A tasks.all worker -c 5 --queue=queue_get_user_info --loglevel=info -n get_user_info@%h\r\n\r\n# 启动获取战绩列表worker\r\ncelery -A tasks.all worker -c 5 --queue=queue_get_battle_list --loglevel=info -n get_battle_list@%h\r\n\r\n# 启动获取战绩详情worker\r\ncelery -A tasks.all worker -c 30 --queue=queue_get_battle_info --loglevel=info -n get_battle_info@%h</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d71d554993428-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d71d554993428-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d71d554993428-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d71d554993428-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d71d554993428-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d71d554993428-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d71d554993428-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d71d554993428-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5c43759c4d71d554993428-1\"><span class=\"crayon-c\"># 启动获取用户详情worker</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d71d554993428-2\"><span class=\"crayon-v\">celery</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">worker</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-k \">queue</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">queue_get_user_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">loglevel</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get_user_info</span><span class=\"crayon-sy\">@</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">h</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d71d554993428-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d71d554993428-4\"><span class=\"crayon-c\"># 启动获取战绩列表worker</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d71d554993428-5\"><span class=\"crayon-v\">celery</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">worker</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-k \">queue</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">queue_get_battle_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">loglevel</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get_battle_list</span><span class=\"crayon-sy\">@</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d71d554993428-6\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d71d554993428-7\"><span class=\"crayon-c\"># 启动获取战绩详情worker</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d71d554993428-8\"><span class=\"crayon-v\">celery</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">worker</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-k \">queue</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">queue_get_battle_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">loglevel</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get_battle_info</span><span class=\"crayon-sy\">@</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">h</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>这样我们的爬虫就可以愉快的跑起来了。再通过celery-flower来查看执行情况。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5c43759c4d720097953872\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncelery flower -A tasks.all --broker=redis://:$REDIS_PASS@$REDIS_HOST:$REDIS_PORT/10</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d720097953872-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5c43759c4d720097953872-1\"><span class=\"crayon-e\">celery </span><span class=\"crayon-v\">flower</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">broker</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">REDIS_PASS</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">REDIS_HOST</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">REDIS_PORT</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">10</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>通过flower，我们可以看到运行的效率还是非常不错的。 <a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/b00e369e578903d15247af774bd02fdb.jpg\"><img class=\"aligncenter size-full wp-image-89210\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/b00e369e578903d15247af774bd02fdb.jpg\" alt=\"15308449650665\"></a> 在执行过程中会发现get_battle_list跑太快，导致get_battle_info即使开了30个并发都还会积压很多，所以需要适时的去停一下这些worker。 在我们抓到20万条信息之后就可以停下来了。</p>\n<h1 id=\"toc_15\">Step 3 数据分析</h1>\n<h2 id=\"toc_16\">分析方案</h2>\n<p>20万场战斗的数据已经抓取好了，全部分成json文件存在我本地磁盘上，接下来就做一些简单的分析。 python在数据分析领域也非常强大，有很多非常优秀的库，如pandas和NumPy，可惜我都没有学过，而且对于一个高考数学只考了70几分的人来说，数据分析实在是难，所以就自己写了一个非常简单的程序来做一些浅度分析。 需要进行深度分析，又不想自己爬虫的大牛可以联系我打包这些数据。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5c43759c4d724438155899\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# coding=utf-8\r\nimport os\r\nimport json\r\nimport datetime\r\nimport math\r\n\r\nfrom conf import settings\r\n\r\n\r\nclass UserTeamTypeData:\r\n    def __init__(self, team_type, player_count):\r\n        self.team_type = team_type\r\n        self.player_count = player_count\r\n        self.label = {}\r\n        self.dead_poison_circle_no = {}\r\n        self.count = 0\r\n        self.damage = 0\r\n        self.survival_duration = 0  # 生存时间\r\n        self.driving_distance = 0\r\n        self.forward_distance = 0\r\n        self.times_assist = 0  # 助攻\r\n        self.times_head_shot = 0\r\n        self.times_kill = 0\r\n        self.times_reborn = 0  # 被救次数\r\n        self.times_save = 0  # 救人次数\r\n        self.top_kill_distance = []\r\n        self.top_kill_distance_weapon_use = {}\r\n        self.vehicle_kill = 0  # 车辆杀死\r\n        self.award_gold = 0\r\n        self.times_reborn_by_role_sex = {0: 0, 1: 0}  # 0 男 1 女\r\n        self.times_save_by_role_sex = {0: 0, 1: 0}  # 0 男 1 女\r\n\r\n    def update_dead_poison_circle_no(self, dead_poison_circle_no):\r\n        if dead_poison_circle_no in self.dead_poison_circle_no:\r\n            self.dead_poison_circle_no[dead_poison_circle_no] += 1\r\n        else:\r\n            self.dead_poison_circle_no[dead_poison_circle_no] = 1\r\n\r\n    def update_times_reborn_and_save_by_role_sex(self, role, times_reborn, times_save):\r\n        if role not in self.times_reborn_by_role_sex:\r\n            return\r\n\r\n        self.times_reborn_by_role_sex[role] += times_reborn\r\n        self.times_save_by_role_sex[role] += times_save\r\n\r\n    def update_top_kill_distance_weapon_use(self, weaponid):\r\n        if weaponid not in self.top_kill_distance_weapon_use:\r\n            self.top_kill_distance_weapon_use[weaponid] = 1\r\n        else:\r\n            self.top_kill_distance_weapon_use[weaponid] += 1\r\n\r\n\r\nclass UserBattleData:\r\n\r\n    def __init__(self, openid):\r\n        self.openid = openid\r\n        self.team_type_res = {}\r\n        self.label = {}\r\n        self.hour_counter = {}\r\n        self.weekday_counter = {}\r\n        self.usetime = 0\r\n        self.day_record = set()\r\n        self.battle_counter = 0\r\n\r\n    def get_avg_use_time_per_day(self):\r\n        # print \"get_avg_use_time_per_day:\", self.openid, self.usetime, len(self.day_record), self.usetime / len(self.day_record)\r\n        return self.usetime / len(self.day_record)\r\n\r\n    def update_label(self, lable):\r\n        if lable in self.label:\r\n            self.label[lable] += 1\r\n        else:\r\n            self.label[lable] = 1\r\n\r\n    def get_team_type_data(self, team_type, player_count):\r\n        player_count = int(math.ceil(float(player_count) / 10))\r\n        team_type_key = '%d_%d' % (team_type, player_count)\r\n\r\n        if team_type_key not in self.team_type_res:\r\n            userteamtypedata = UserTeamTypeData(team_type, player_count)\r\n            self.team_type_res[team_type_key] = userteamtypedata\r\n        else:\r\n            userteamtypedata = self.team_type_res[team_type_key]\r\n\r\n        return userteamtypedata\r\n\r\n    def update_user_time_property(self, dt_event_time):\r\n        dt_event_time = datetime.datetime.fromtimestamp(dt_event_time)\r\n        hour = dt_event_time.hour\r\n        if hour in self.hour_counter:\r\n            self.hour_counter[hour] += 1\r\n        else:\r\n            self.hour_counter[hour] = 1\r\n\r\n        weekday = dt_event_time.weekday()\r\n        if weekday in self.weekday_counter:\r\n            self.weekday_counter[weekday] += 1\r\n        else:\r\n            self.weekday_counter[weekday] = 1\r\n\r\n        self.day_record.add(dt_event_time.date())\r\n\r\n    def update_battle_info_by_room(self, roomid):\r\n        # print '  load ', self.openid, roomid\r\n        file = os.path.join(settings.Res_UserBattleInfo_Dir, self.openid, '%s.txt' % roomid)\r\n\r\n        with open(file, 'r') as rf:\r\n            battledata = json.load(rf)\r\n\r\n        self.battle_counter += 1\r\n        base_info = battledata['base_info']\r\n        self.update_user_time_property(base_info['dt_event_time'])\r\n        battle_info = battledata['battle_info']\r\n\r\n        userteamtypedata = self.get_team_type_data(base_info['team_type'], base_info['player_count'])\r\n        userteamtypedata.count += 1\r\n        userteamtypedata.award_gold += battle_info['award_gold']\r\n        userteamtypedata.damage += battle_info['damage']\r\n        userteamtypedata.update_dead_poison_circle_no(battle_info['dead_poison_circle_no'])\r\n        userteamtypedata.driving_distance += battle_info['driving_distance']\r\n        userteamtypedata.forward_distance += battle_info['forward_distance']\r\n        self.update_label(battle_info['label'])\r\n        userteamtypedata.survival_duration += battle_info['survival_duration']\r\n        self.usetime += battle_info['survival_duration']/60\r\n        userteamtypedata.times_assist += battle_info['times_assist']\r\n        userteamtypedata.times_head_shot += battle_info['times_head_shot']\r\n        userteamtypedata.times_kill += battle_info['times_kill']\r\n        userteamtypedata.times_reborn += battle_info['times_reborn']\r\n        userteamtypedata.times_save += battle_info['times_save']\r\n        userteamtypedata.damage += battle_info['damage']\r\n        userteamtypedata.top_kill_distance.append(battle_info['top_kill_distance'])\r\n        userteamtypedata.update_times_reborn_and_save_by_role_sex(base_info['role_sex'], battle_info['times_reborn'],\r\n                                                                  battle_info['times_save'])\r\n\r\n    def get_user_battleinfo_rooms(self):\r\n        user_dir = os.path.join(settings.Res_UserBattleInfo_Dir, self.openid)\r\n        r = [room for room in os.listdir(user_dir)]\r\n        r = [rr.replace('.txt', '') for rr in r]\r\n        return r\r\n\r\nclass AllUserCounter:\r\n\r\n    def __init__(self):\r\n        self.hour_counter = {0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 14: 0, 15: 0, 16: 0, 17: 0, 18: 0, 19: 0, 20: 0, 21: 0, 22: 0, 23: 0}\r\n\r\n        self.weekday_counter = {0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0}\r\n        self.times_reborn_by_role_sex = {0: 0, 1: 0}  # 0 男 1 女\r\n        self.times_save_by_role_sex = {0: 0, 1: 0}  # 0 男 1 女\r\n        self.user_count = 0\r\n        self.battle_count = 0\r\n        self.every_user_use_time_per_day = []\r\n        self.top_kill_distance = 0\r\n\r\n    def avg_use_time(self):\r\n        return sum(self.every_user_use_time_per_day) / len(self.every_user_use_time_per_day)\r\n\r\n    def add_user_data(self, userbattledata):\r\n        self.every_user_use_time_per_day.append(userbattledata.get_avg_use_time_per_day())\r\n        self.battle_count += userbattledata.battle_counter\r\n        self.user_count += 1\r\n\r\n        for k in userbattledata.hour_counter:\r\n            if k in self.hour_counter:\r\n                self.hour_counter[k] += userbattledata.hour_counter[k]\r\n            else:\r\n                self.hour_counter[k] = userbattledata.hour_counter[k]\r\n\r\n        for weekday in userbattledata.weekday_counter:\r\n            if weekday in self.weekday_counter:\r\n                self.weekday_counter[weekday] += userbattledata.weekday_counter[weekday]\r\n            else:\r\n                self.weekday_counter[weekday] = userbattledata.weekday_counter[weekday]\r\n\r\n        for userteamtype in userbattledata.team_type_res:\r\n            userteamtypedata = userbattledata.team_type_res[userteamtype]\r\n            for k in userteamtypedata.times_reborn_by_role_sex:\r\n                self.times_reborn_by_role_sex[k] += userteamtypedata.times_reborn_by_role_sex[k]\r\n\r\n            for k in userteamtypedata.times_save_by_role_sex:\r\n                self.times_save_by_role_sex[k] += userteamtypedata.times_save_by_role_sex[k]\r\n\r\n            if userteamtypedata.top_kill_distance &gt; self.top_kill_distance:\r\n                self.top_kill_distance = userteamtypedata.top_kill_distance\r\n\r\n    def __str__(self):\r\n        res = []\r\n        res.append('总用户数\\t%d' % self.user_count)\r\n        res.append('总战斗数\\t%d' % self.battle_count)\r\n        res.append('平均日耗时\\t%d' % self.avg_use_time())\r\n        res.append('最远击杀\\t%d' % max(self.top_kill_distance))\r\n        res.append('男性角色\\t被救%d次\\t救人%d次' % (self.times_reborn_by_role_sex[0], self.times_save_by_role_sex[0]))\r\n        res.append('女性角色\\t被救%d次\\t救人%d次' % (self.times_reborn_by_role_sex[1], self.times_save_by_role_sex[1]))\r\n\r\n        res.append('小时分布')\r\n        for hour in range(0, 24):\r\n            # res.append('\\t%d: %d' % (hour, self.hour_counter[hour]))\r\n            res.append('\\t%d: %d %.2f%%' % (hour, self.hour_counter[hour], self.hour_counter[hour]/float(self.battle_count)*100))\r\n        res.append('星期分布')\r\n        # res.append(self.weekday_counter.__str__())\r\n        for weekday in range(0, 7):\r\n            res.append('\\t%d: %d %.2f%%' % (weekday+1, self.weekday_counter[weekday], (self.weekday_counter[weekday]/float(self.battle_count)*100)))\r\n\r\n        return '\\n'.join(res)\r\n\r\n\r\ndef get_user_battleinfo_rooms(openid):\r\n    user_dir = os.path.join(settings.Res_UserBattleInfo_Dir, openid)\r\n\r\n    # files = os.listdir(user_dir)\r\n    r = [room for room in os.listdir(user_dir)]\r\n    r = [rr.replace('.txt', '') for rr in r]\r\n    return r\r\n\r\n\r\nif __name__ == '__main__':\r\n    alluserconter = AllUserCounter()\r\n    \r\n    folders = os.listdir(settings.Res_UserBattleInfo_Dir)\r\n    i = 0\r\n    for folder in folders:\r\n        i+=1\r\n        print i, '/' , len(folders), folder\r\n        userbattledata = UserBattleData(folder)\r\n        for room in userbattledata.get_user_battleinfo_rooms():\r\n            userbattledata.update_battle_info_by_room(room)\r\n        alluserconter.add_user_data(userbattledata)\r\n\r\n    print \"\\n\" * 3\r\n    print \"---------------------------------------\"\r\n\r\n    print alluserconter</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-229\">229</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5c43759c4d724438155899-230\">230</div><div class=\"crayon-num\" data-line=\"crayon-5c43759c4d724438155899-231\">231</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-1\"><span class=\"crayon-c\"># coding=utf-8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-3\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">datetime</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">math</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-6\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-7\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">conf </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">settings</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-8\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-10\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UserTeamTypeData</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">team_type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">player_count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">team_type</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-13\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">player_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">player_count</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-14\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">damage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">survival_duration</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 生存时间</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">driving_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">forward_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_assist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 助攻</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_head_shot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 被救次数</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 救人次数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance_weapon_use</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">vehicle_kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 车辆杀死</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">award_gold</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 0 男 1 女</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 0 男 1 女</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-32\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update_dead_poison_circle_no</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dead_poison_circle_no </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-38\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update_times_reborn_and_save_by_role_sex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">role</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">times_reborn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">times_save</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">role </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-42\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">role</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">times_reborn</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-44\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">role</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">times_save</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-46\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update_top_kill_distance_weapon_use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weaponid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weaponid </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance_weapon_use</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-48\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance_weapon_use</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weaponid</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-50\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance_weapon_use</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weaponid</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-52\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-53\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UserBattleData</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-54\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">openid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">openid</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-57\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type_res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">usetime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-62\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">day_record</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-64\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_avg_use_time_per_day</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># print \"get_avg_use_time_per_day:\", self.openid, self.usetime, len(self.day_record), self.usetime / len(self.day_record)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">usetime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">day_record</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-68\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-69\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update_label</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lable</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lable </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-71\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">lable</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-72\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-73\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">lable</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-74\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-75\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_team_type_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">team_type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">player_count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">player_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ceil</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">player_count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">team_type_key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%d_%d'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">team_type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">player_count</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-78\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-79\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">team_type_key </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type_res</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-80\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">UserTeamTypeData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">team_type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">player_count</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-81\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type_res</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">team_type_key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userteamtypedata</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-82\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-83\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type_res</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">team_type_key</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-84\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-85\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userteamtypedata</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-86\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-87\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update_user_time_property</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dt_event_time</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-88\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">dt_event_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">datetime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">datetime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fromtimestamp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dt_event_time</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-89\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">hour</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dt_event_time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hour</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-90\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hour </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-91\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hour</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-92\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-93\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hour</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-94\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-95\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">weekday</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dt_event_time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">weekday</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-96\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weekday </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-97\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-98\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-99\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-100\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-101\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">day_record</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dt_event_time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-102\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-103\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update_battle_info_by_room</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">roomid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-104\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># print '  load ', self.openid, roomid</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-105\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Res_UserBattleInfo_Dir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%s.txt'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">roomid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-106\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-107\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">file</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'r'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rf</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-108\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">battledata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rf</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-109\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-110\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-111\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">base_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battledata</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'base_info'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-112\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_user_time_property</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">base_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'dt_event_time'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-113\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battledata</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'battle_info'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-114\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-115\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_team_type_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">base_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'team_type'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">base_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'player_count'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-116\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-117\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">award_gold</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'award_gold'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-118\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">damage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'damage'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-119\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_dead_poison_circle_no</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'dead_poison_circle_no'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-120\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">driving_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'driving_distance'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-121\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">forward_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'forward_distance'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-122\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_label</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'label'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-123\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">survival_duration</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'survival_duration'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-124\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">usetime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'survival_duration'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">60</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-125\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_assist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_assist'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-126\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_head_shot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_head_shot'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-127\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_kill'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-128\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_reborn'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-129\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_save'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-130\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">damage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'damage'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-131\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'top_kill_distance'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-132\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_times_reborn_and_save_by_role_sex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">base_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'role_sex'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_reborn'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-133\"><span class=\"crayon-h\">                                                                  </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_save'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-134\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-135\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_user_battleinfo_rooms</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-136\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">user_dir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Res_UserBattleInfo_Dir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-137\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">room </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">room </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user_dir</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-138\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">rr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'.txt'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rr </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-139\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-140\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-141\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AllUserCounter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-142\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-143\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-144\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-145\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-146\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-147\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 0 男 1 女</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-148\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 0 男 1 女</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-149\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-150\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-151\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">every_user_use_time_per_day</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-152\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-153\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-154\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">avg_use_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-155\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">every_user_use_time_per_day</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">every_user_use_time_per_day</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-156\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-157\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add_user_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-158\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">every_user_use_time_per_day</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_avg_use_time_per_day</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-159\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">battle_counter</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-160\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-161\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-162\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-163\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-164\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-165\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-166\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-167\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-168\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weekday </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-169\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weekday </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-170\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-171\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-172\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-173\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-174\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userteamtype </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type_res</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-175\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type_res</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">userteamtype</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-176\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-177\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-178\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-179\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-180\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-181\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-182\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-183\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">top_kill_distance</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-184\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-185\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__str__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-186\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-187\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'总用户数\\t%d'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user_count</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-188\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'总战斗数\\t%d'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_count</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-189\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'平均日耗时\\t%d'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">avg_use_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-190\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'最远击杀\\t%d'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-191\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'男性角色\\t被救%d次\\t救人%d次'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-192\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'女性角色\\t被救%d次\\t救人%d次'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-193\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-194\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'小时分布'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-195\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hour </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">24</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-196\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\"># res.append('\\t%d: %d' % (hour, self.hour_counter[hour]))</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-197\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'\\t%d: %d %.2f%%'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hour</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hour</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hour</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-198\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'星期分布'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-199\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># res.append(self.weekday_counter.__str__())</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-200\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weekday </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-201\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'\\t%d: %d %.2f%%'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-202\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-203\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-204\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-205\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-206\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_user_battleinfo_rooms</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-207\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">user_dir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Res_UserBattleInfo_Dir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-208\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-209\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># files = os.listdir(user_dir)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-210\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">room </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">room </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user_dir</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-211\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">rr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'.txt'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rr </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-212\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-213\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-214\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-215\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-216\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">alluserconter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AllUserCounter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-217\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-218\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">folders</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Res_UserBattleInfo_Dir</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-219\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-220\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">folder </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">folders</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-221\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-222\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">folders</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">folder</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-223\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">UserBattleData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">folder</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-224\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">room </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_user_battleinfo_rooms</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-225\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_battle_info_by_room</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">room</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-226\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">alluserconter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_user_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-227\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-228\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-229\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"---------------------------------------\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5c43759c4d724438155899-230\"> </div><div class=\"crayon-line\" id=\"crayon-5c43759c4d724438155899-231\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alluserconter</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0522 seconds] -->\r\n<p></p>\n<h2 id=\"toc_17\">分析结果</h2>\n<h3 id=\"toc_18\">1. 平均用户日在线时长2小时</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/8940542ebc9c37ee3eaee6e203483a6f.jpg\"><img class=\"aligncenter size-full wp-image-89216\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/8940542ebc9c37ee3eaee6e203483a6f.jpg\" alt=\"15311020770066\"></a> 从分布图上看大部分用户都在1小时以上，最猛的几个人超过8小时。</p>\n<blockquote><p>注：我这里统计的是每一局的存活时间，实际在线时长会比我这个更长。</p></blockquote>\n<h3 id=\"toc_19\">2. 女性角色被救次数高于男性</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/64962287acd44acf2aac8536ca0899fc.jpg\"><img class=\"aligncenter size-full wp-image-89214\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/64962287acd44acf2aac8536ca0899fc.jpg\" alt=\"15311012585793\"></a> 终于知道为什么有那么多人妖了，原来在游戏里面可以占便宜啊。</p>\n<h3 id=\"toc_20\">3. 女性角色救人次数高于男性</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/f844d5217fd5cb34ca85f7901f624bbc.jpg\"><img class=\"aligncenter size-full wp-image-89215\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/f844d5217fd5cb34ca85f7901f624bbc.jpg\" alt=\"15311012987492\"></a> 给了大家一个带妹上分的好理由。</p>\n<h3 id=\"toc_21\">4. 周五大家最忙<a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/e115076ed529c5cd1476fd540a67bcbf.jpg\"><img class=\"aligncenter size-full wp-image-89213\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/e115076ed529c5cd1476fd540a67bcbf.jpg\" alt=\"15310699545478\"></a></h3>\n<p>估计周五大家都要忙着交差和写周报了。</p>\n<h3 id=\"toc_22\">5. 晚上22点是游戏高峰</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/d200c720265690fef4bf02b8126c0e46.jpg\"><img class=\"aligncenter size-full wp-image-89217\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/d200c720265690fef4bf02b8126c0e46.jpg\" alt=\"15311024917841\"></a> 凌晨还有那么多人玩，你们不睡觉吗？</p>\n<h3 id=\"toc_23\">6. 最远击杀距离639米</h3>\n<p>我看了一下98K、SKS 和 AWP 的有效射程，大致都在 800 米以内，所以这个值可信度还是可以的。 反过来看抖音上的那些超远距离击杀应该都是摆拍的。</p>\n<h3 id=\"toc_24\">7. 能拿到「救死扶伤」称号才是最高荣耀</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/5572d1c4599b78e5ade96592b7753cee.jpg\"><img class=\"aligncenter size-full wp-image-89218\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/5572d1c4599b78e5ade96592b7753cee.jpg\" alt=\"15311041446783\"></a></p>\n<p>从分布情况可以看出来，救死扶伤比十杀还要难。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/14972380724a5b735cf2e80d3ad9b178.jpg\"><img class=\"aligncenter size-full wp-image-89219\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/14972380724a5b735cf2e80d3ad9b178.jpg\" alt=\"15311063423105\"></a> 能拿到救死扶伤称号的大部分都是女性角色，再一次证明玩游戏要带妹。 回归到这个游戏的本质，那就是生存游戏，没什么比活下来更重要的了。</p>\n<h1 id=\"toc_25\">结尾</h1>\n<p>这次爬虫主要是利用了微信游戏频道可以查看陌生人数据的场景才能提取到这么多数据。我们可以通过同样的手段来分析王者荣耀和其它游戏的数据，有兴趣的同学可以尝试一下。 最后再说一下，UMP9 是把好枪，配 2 倍镜非常爽。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89209\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89209votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89209\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 13 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 6 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx4134404245\">张波</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx4134404245\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/f56c1c12931d802097a2908cbf020f99.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            先后从事过测试、运维、开发和需求分析工作，主要开发语言是 Python，现任一家小型公司技术团队负责人。微信号：zhangbo_369029696        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/wx4134404245\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/wx4134404245/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/wx4134404245/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 5</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "D:/code/scrapy/Tencent\\images\\实践项目,,吃鸡数据\\用 Python 分析了 20 万场吃鸡数据_scrapy.jpg"},
{"url": "http://python.jobbole.com/89175/", "url_object_id": "80d68ccf40ef8aecd0ecd87d7e28d4a6", "front_image_url": ["https://shuhari.github.io/blog/media/2018/01/python-projects-loc.jpg"], "title": "Python 项目可以有多大_scrapy", "create_date": "2019-01-20", "praise_nums": 1, "comment_nums": 0, "fav_nums": 0, "tags": "实践项目,Python,软件工程", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://yuhao.space/blog/2018/1/how-large-python-projects-can-be/\">YuHao</a>   </div><div>\n<p>总是看到有人说，动态一时爽，重构火葬场。然而这世界上有的是著名的开源项目， 也有像 Github、Instagram 这样流量巨大的知名网站是基于动态语言开发的，经过了这么多年重构，也未听说哪个作者进了火葬场的，不明白这些人是真的不知道还是装作看不见呢？不过他们说动态语言大到一定程度就无法维护，虽然这话也同样不值一驳，不过也提醒了我，我也很好奇用动态语言开发的项目规模能大到什么程度。</p>\n<p>从我知道的信息看，用动态语言开发的最大规模的项目可能要算是 <a href=\"https://www.openstack.org\">OpenStack</a>，据说代码总量已经达到数百万行，并且还在持续增加中。这当然是一个说明动态语言能力的好例子。不过像这样巨大的项目，要分析起来也并不容易（好吧，真正的原因是我懒得下载那么庞大的代码库）。我选择了 Python 社区中比较知名的一些项目来分析，主要是来自 Github ，也有个别来自其他仓库。这个选择可能包含了一定的主观因素在内，不过我相信大多数项目还是非常有代表性的。</p>\n<p>计算代码数量的工具是 <a href=\"https://github.com/AlDanial/cloc\">cloc</a>。所有项目均选择截止到 2018 年 1 月 3 日的主干代码，统计中仅包含 Python 文件，排除了其他文件类型。值得说明的一点是， 通过 Ubuntu APT 默认安装的 cloc 版本 1.60 在统计部分项目的时候存在问题，该问题在最新的版本中已经得到解决，因此本文中所有统计均使用从官网下载的 cloc v1.72。</p>\n<table>\n<thead>\n<tr>\n<th>项目</th>\n<th>文件</th>\n<th>空白行</th>\n<th>注释行</th>\n<th>代码行</th>\n<th>代码行/文件</th>\n<th>注释/代码</th>\n<th>类型</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Sentry</td>\n<td>1,828</td>\n<td>32,745</td>\n<td>16,593</td>\n<td>698,733</td>\n<td>409.23</td>\n<td>2.22%</td>\n<td>py,po</td>\n</tr>\n<tr>\n<td>CPython</td>\n<td>1,775</td>\n<td>106,670</td>\n<td>132,042</td>\n<td>496,500</td>\n<td>414.20</td>\n<td>17.96%</td>\n<td>py,c</td>\n</tr>\n<tr>\n<td>Salt</td>\n<td>2,432</td>\n<td>158,906</td>\n<td>248,391</td>\n<td>486,106</td>\n<td>367.35</td>\n<td>27.80%</td>\n<td>py,js</td>\n</tr>\n<tr>\n<td>Ansible</td>\n<td>2,641</td>\n<td>109,406</td>\n<td>254,073</td>\n<td>383,396</td>\n<td>282.80</td>\n<td>13.41%</td>\n<td>py,yaml</td>\n</tr>\n<tr>\n<td>wxPython</td>\n<td>1,611</td>\n<td>95,293</td>\n<td>94,784</td>\n<td>220,420</td>\n<td>254.81</td>\n<td>23.09%</td>\n<td>py,c</td>\n</tr>\n<tr>\n<td>Django</td>\n<td>1,906</td>\n<td>50,634</td>\n<td>48,494</td>\n<td>219,999</td>\n<td>167.43</td>\n<td>15.20%</td>\n<td>py,po</td>\n</tr>\n<tr>\n<td>Pandas</td>\n<td>561</td>\n<td>64,291</td>\n<td>57,207</td>\n<td>213,402</td>\n<td>596.97</td>\n<td>17.08%</td>\n<td>py,html</td>\n</tr>\n<tr>\n<td>Odoo</td>\n<td>2,010</td>\n<td>31,394</td>\n<td>37,042</td>\n<td>158,106</td>\n<td>112.71</td>\n<td>16.35%</td>\n<td>po,js</td>\n</tr>\n<tr>\n<td>youtube-dl</td>\n<td>830</td>\n<td>15,343</td>\n<td>6,666</td>\n<td>108,276</td>\n<td>156.97</td>\n<td>5.12%</td>\n<td>py,markdown</td>\n</tr>\n<tr>\n<td>NumPy</td>\n<td>380</td>\n<td>33,578</td>\n<td>68,711</td>\n<td>102,490</td>\n<td>538.89</td>\n<td>33.55%</td>\n<td>c,py</td>\n</tr>\n<tr>\n<td>PyTorch</td>\n<td>381</td>\n<td>14,014</td>\n<td>15,435</td>\n<td>46,895</td>\n<td>200.38</td>\n<td>20.22%</td>\n<td>py,cuda</td>\n</tr>\n<tr>\n<td>Django-CMS</td>\n<td>302</td>\n<td>9,459</td>\n<td>8,089</td>\n<td>41,492</td>\n<td>195.50</td>\n<td>13.70%</td>\n<td>po,py</td>\n</tr>\n<tr>\n<td>Keras</td>\n<td>158</td>\n<td>9,707</td>\n<td>13,972</td>\n<td>37,484</td>\n<td>387.11</td>\n<td>22.84%</td>\n<td>py,markdown</td>\n</tr>\n<tr>\n<td>Pillow</td>\n<td>267</td>\n<td>9,064</td>\n<td>8,733</td>\n<td>26,348</td>\n<td>165.34</td>\n<td>19.78%</td>\n<td>py,c</td>\n</tr>\n<tr>\n<td>Scrapy</td>\n<td>340</td>\n<td>6,800</td>\n<td>4,106</td>\n<td>24,874</td>\n<td>105.24</td>\n<td>11.48%</td>\n<td>py,xml</td>\n</tr>\n<tr>\n<td>Flask</td>\n<td>71</td>\n<td>3,448</td>\n<td>3,524</td>\n<td>8,768</td>\n<td>221.68</td>\n<td>22.39%</td>\n<td>py,html</td>\n</tr>\n<tr>\n<td>Fabric</td>\n<td>78</td>\n<td>2,341</td>\n<td>4,333</td>\n<td>7,314</td>\n<td>179.33</td>\n<td>30.98%</td>\n<td>py,yaml</td>\n</tr>\n</tbody>\n</table>\n<p>上表已经按代码行数排了序。有意思的一点是， 代码规模最大的前4名中除了 CPython 之外其他三个全部是运维性质的项目，本来我猜测代码应该比较多的项目比如 Odoo 排名反而很靠后。我对运维项目了解有限，不太清楚为什么这些项目的代码规模会名列前茅，或许是因为要支持的内容比较多而杂？</p>\n<p><img src=\"https://shuhari.github.io/blog/media/2018/01/python-projects-loc.jpg\" alt=\"代码量统计\"></p>\n<p>本次统计中纯 Python 代码量最大的 Sentry 几乎达到了 70W 行，这是相当有规模的项目了。30W~50W 行代码的项目有三个，包括基础项目 CPython 在内。20W 和 10W 行代码规模的分别有三个，剩下 7 个则在 10W 行以内。看过这个列表你应当相信，动态语言至少在几十W行代码的项目上是完全没有问题的。这也是绝大多数普通应用的上限了，如果代码真的达到数百万行规模的话，那么无论用什么语言，都势必面临着拆分项目的问题。</p>\n<p>上表将代码量指标按照代码/空白/注释进行了分类，也在一定程度上反应了项目的代码风格。Sentry 是本次统计中代码量最多的项目，然而从表中可以看到，项目中的注释和其他项目相比，少得有点不成比例，说明 Sentry 的作者非常不注重注释。</p>\n<p>同学们一定发现了，我在列表中除了代码行相关的指标之外还增加了几个其他内容，这也是我个人比较感兴趣的方面。</p>\n<p><img src=\"https://shuhari.github.io/blog/media/2018/01/python-projects-loc-file.jpg\" alt=\"代码行/文件统计\"></p>\n<p>第一个指标是每个文件的平均代码行数。按照模块化的观点，单个文件中堆砌太多内容显然是不合理的，这通常意味着耦合太多、难于理解和修改。然而到底多少算是合适，并没有一个明确的标准。我希望通过这些项目的分析，了解一下开源作者们在实践中做出的选择。</p>\n<p>统计的结果分布比较平均，从 100~600行/文件的都存在，并不存在明显的集中点。有趣的是，头两名（Pandas, NumPy）有着紧密的联系，都是和数学统计相关的。这可能是因为数学库的特点比较纯粹而单一，不像其他类库那样容易划分。末尾的项目（Pillow, youtube-dl, Odoo, Scrapy）可以从侧面印证这种猜想：它们都是面向特定领域的，所以更加容易模块化。</p>\n<p><img src=\"https://shuhari.github.io/blog/media/2018/01/python-projects-comment-code.jpg\" alt=\"注释/代码统计\"></p>\n<p>第二个指标是注释和代码的比例，这个问题也有着类似的情况。注释并非越详尽越好，但总是需要一定量的注释来解释 Why 的问题。注释太少，说明项目的作者没有给后来的维护人员留下足够的线索，可能会造成维护上的问题。另一方面，我们考察的全部是开源项目，没有公司考核或者 KPI 的约束，所以我们可以放心的相信不会存在作者故意多写注释的问题。前面提到的 Sentry 毫无争议的因为注释太少排到了最后，这未必说明这个项目很差，但至少是一个信号，说明该项目在维护方面可能是存在问题的。而对于那些作者愿意投入精力来写注释的项目（Ansible, NumPy, Fabric, Salt 等），足以反映作者在项目上投入了相当大的心力，这是一个好的信号，说明这些项目是值得信赖的。</p>\n<p>有一点是出乎我意料的，那就是作为所有项目之母的 CPython 排名比较靠后，按照道理这个基础项目应该有更多的注释才对。不过再想一想又觉得可以理解，因为 CPython 有单独发布的、非常详尽的文档，这是其他大多数项目都没有的，那么代码中的注释少一些也是情有可原的。</p>\n<p><img src=\"https://shuhari.github.io/blog/media/2018/01/python-projects-filetype.jpg\" alt=\"文件类型统计\"></p>\n<p>最后一项统计是关于文件类型的。Python 项目中绝大多数应该是 Python 代码，这点没有什么疑问，但同时我也想看看除了 Python 代码之外，一个项目还包括哪些主要文件。C/HTML/Javascipt 的上榜是毫不意外的，但有一种文件我事先没有想到，那就是 .PO（开源项目常用的语言资源文件）。对于 Django 和 Django-CMS 这两个项目, PO 代码数量甚至比 Python 代码还要多。大概看了一下，Django 支持 90 种以上的语言，这也无怪乎语言文件的数量如此之多了。这个结果也可以提醒我们，有些同学——不仅是程序员，也包括大多数经验不足的老板、客户、产品经理等——会下意识的认为程序开发无非是写代码，对于代码之外的其他工作，在估算的时候往往只拍脑袋式的定下一个极短的时间。但对于实际的项目来说，代码仅仅是其中的一部分，“其他工作”有时候——应该说是经常——会占用你大部分的的时间和精力。这些工作往往并不有趣，但对于项目来说又是必不可少的组成部分，希望同学们予以足够的重视。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89175\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89175votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89175\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "D:/code/scrapy/Tencent\\images\\实践项目,Python,软件工程\\Python 项目可以有多大_scrapy.jpg"},
{"url": "http://python.jobbole.com/88705/", "url_object_id": "b85caf508c0e926ffb6e05e78454a360", "front_image_url": ["http://wx1.sinaimg.cn/mw690/63918611gy1fmukayefezj20sw0e447u.jpg"], "title": "使用 Python 开始机器学习_scrapy", "create_date": "2019-01-20", "praise_nums": 3, "comment_nums": 7, "fav_nums": 21, "tags": "工具与框架,框架,,机器学习", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/buntamarui\">小米云豆粥</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://monkeylearn.com/blog/getting-started-with-python-machine-learning/\"> Bruno Stecanella</a>。欢迎加入<a target=\"_blank\" href=\"https://github.com/jobbole/translation-project\">翻译组</a>。</div><p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fmukayefezj20sw0e447u.jpg\" width=\"690\" height=\"337\"></p>\n<p>目前机器学习红遍全球。男女老少都在学机器学习模型，分类器，神经网络和吴恩达。你也想成为一份子，但你该如何开始？</p>\n<p>在这篇文章中我们会讲Python的重要特征和它适用于机器学习的原因，介绍一些重要的机器学习包，以及其他你可以获取更详细资源的地方。</p>\n<h2>为什么用Python做机器学习</h2>\n<p>Python很适合用于机器学习。首先，它很简单。如果你完全不熟悉Python但是有一些其他的编程经验（C或者其他编程语言），要上手是很快的。其次，Python的社区很强大。这使得Python的文档不仅条理性好，而且容易读。你还可以在StackOverFlow上找到关于很多问题详细解答（学习基石）。再次，一个强大的社区带来的副产品就是大量有用程序库（Python内部自带的和第三方软件），基本上可以解决你所有的问题（包括机器学习）。</p>\n<h3>但我听说Python很慢</h3>\n<p>Python是很慢。它不是执行最快的语言，拥有那么多好用的抽象是要付出代价的。</p>\n<p>但这是个可以解决的问题：程序库可以把计算量繁重的部分外包给其他更高效（但更难使用）的语言，例如C和C++。比如NumPy这个提供数值运算的程序库，就是用C写的，运行速度超快。在实际运用中，几乎所有程序库都会使用NumPy去完成计算繁重的部分。如果你看到Numpy，你应该想到它很快。</p>\n<p>所以你是可以让程序的运行速度跟它的低层语言实现的运行速度相比拟的。你没有必要担心程序的运行速度。</p>\n<p> </p>\n<h2>值得知道的Python程序库</h2>\n<h3>Scikit-learn</h3>\n<p>你刚开始学机器学习吗？如果你需要一个涵盖了特征工程，模型训练和模型测试所有功能的程序库，<a href=\"http://scikit-learn.org/\" target=\"_blank\" rel=\"noopener noreferrer\">scikit-learn</a>是你的最佳选择！这个优秀的免费软件提供了机器学习和数据挖掘所需要的所有工具。它是目前Python机器学习的标准库。要使用任何成熟的机器学习算法都推荐使用这个库。</p>\n<p>这个程序库支持分类和回归，实现了基本所有的经典算法（支持向量机，随机森林，朴素贝叶斯等等）。程序库的设计让迁移算法十分容易，使用不同的算法做实验非常轻松。这些经典算法可用性很强，能用于大量不同的情况。</p>\n<p>但这并不是Scikit-learn的全部功能，它同样可以用来做降维，聚类等等任何你所能想到的。由于它构建在Numpy和Scipy之上（所有的数值计算都是由C语言来完成的），它的运行速度也超快。</p>\n<p><a href=\"http://scikit-learn.org/stable/auto_examples/index.html#general-examples\" target=\"_blank\" rel=\"noopener noreferrer\">这些例子</a>可以告诉你这个库的功能，如果你想学习如何使用它，可以阅读<a href=\"http://scikit-learn.org/stable/tutorial/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">教程。</a></p>\n<h3>NLTK</h3>\n<p><a href=\"http://www.nltk.org/\">NLTK</a>不算是一个机器学习的程序库，但它是做自然语言处理（NLP）必须的一个库。除了用于文字处理的功能，例如聚类，分词，词干提取，标记，解析等，它还包含了大量的数据集和其他关于词法的资源（可用于模型训练）。</p>\n<p>把所有这些打包在一起的好处就不用再多说了。如果你对NLP感兴趣，可以看看<a href=\"http://textminingonline.com/dive-into-nltk-part-i-getting-started-with-nltk\" target=\"_blank\" rel=\"noopener noreferrer\">这些教程</a>!</p>\n<h3>Theano</h3>\n<p><a href=\"http://deeplearning.net/software/theano/\" target=\"_blank\" rel=\"noopener noreferrer\">Theano</a>被广泛应用于工业界和学术界，它是所有深度学习架构的鼻祖。Theano是用Python，结合Numpy实现的。你可以用它来构建用多维数组实现神经网络。Theano会处理所有数学计算，你不需要知道底层的数学公式实现。</p>\n<p>早在支持使用GPU进行计算不像今天这样普及的时候，Theano就已经提供了对GPU计算的支持。这个程序库目前已经非常成熟，能够支持很多不同类型的操作。这使得Theano可以在和其他库比较的时候胜出。</p>\n<p>目前关于Theano最大的问题是API不是很好用，对于新手来说上手困难。不过市面上已经有了解决这个问题的封装包，比如<a href=\"https://keras.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Keras</a>, <a href=\"https://github.com/mila-udem/blocks\" target=\"_blank\" rel=\"noopener noreferrer\">Blocks</a> 和 <a href=\"https://github.com/Lasagne/Lasagne\" target=\"_blank\" rel=\"noopener noreferrer\">Lasagne</a>，都可以简化Theano的使用。</p>\n<h3>TensorFlow</h3>\n<p>谷歌大脑团队为了内部使用创造了<a href=\"https://www.tensorflow.org/\" target=\"_blank\" rel=\"noopener noreferrer\">TensorFlow</a>，2015年将其开源化。设计初衷是取代他们已有的封闭机器学习框架DistBelief，据说该构架太过于依赖Google的整体构架，也不够灵活，在分享代码的时候非常不方便。</p>\n<p>于是就有了TensorFlow。谷歌从以前的错误中吸取了教训。许多人认为TensorFlow是Theano的改进版，它提供了更灵活和好用的API。可以用于科研和工业界，同时支持使用大量的GPU进行模型训练。TensorFlow支持的操作没有Theano多，但是它的<a href=\"https://www.tensorflow.org/get_started/graph_viz\">计算可视化</a>比Theano好。</p>\n<p>TensorFlow目前非常流行。如果今天这篇文章里面提到的名字你只听说了一个，那很有可能是这个。每天都有新的提到TensorFlow的博文或学术文章发表。这个流行度提供了大量的用户和<a href=\"https://www.tensorflow.org/tutorials/\" target=\"_blank\" rel=\"noopener noreferrer\">教程</a>，新人很容易上手。</p>\n<h3>Keras</h3>\n<p><a href=\"https://keras.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Keras</a>是一个提供更高层神经网络API的库，它可以基于Theano或者TensorFlow。它拥有这两个库强大的功能却又同时大大地简化了使用难度。它将用户的体验放在首要地位，提供简单的API和很有用的错误信息。</p>\n<p>同时Keras的设计基于模块，这就使得你能自由组合不同的模型（神经层，成本函数等等），而且模型的可扩展性很好，因为你只需要简单的将新模块跟已有的连起来即可。</p>\n<p>有人觉得Keras太好用了，<a href=\"https://news.ycombinator.com/item?id=13872764\">简直就是在作弊</a>。如果你开始用深度学习，可以看看<a href=\"https://github.com/fchollet/keras#getting-started-30-seconds-to-keras\" target=\"_blank\" rel=\"noopener noreferrer\">例子</a> 和 <a href=\"https://keras.io/getting-started/functional-api-guide/\" target=\"_blank\" rel=\"noopener noreferrer\">文档</a>，对于你可以用它做什么有个数。如果你要学习使用它，可以从 <a href=\"https://elitedatascience.com/keras-tutorial-deep-learning-in-python\" target=\"_blank\" rel=\"noopener noreferrer\">这个教程</a>开始。</p>\n<p>两个类似的库有<a href=\"https://github.com/Lasagne/Lasagne\" target=\"_blank\" rel=\"noopener noreferrer\">Lasagne</a> 和 <a href=\"https://github.com/mila-udem/blocks\" target=\"_blank\" rel=\"noopener noreferrer\">Blocks</a>, 但它们只支持Theano。如果你试过了Keras但是你不喜欢它你可以试试这些其他的库，也许它们更适合你。</p>\n<h3>PyTorch</h3>\n<p>还有一个有名的深度学习架构是<b><a href=\"http://torch.ch/\" target=\"_blank\" rel=\"noopener noreferrer\">Torch</a>，</b>它是用Lua实现的。Facebook用Python实现了Torch，叫做<a href=\"http://pytorch.org/\" target=\"_blank\" rel=\"noopener noreferrer\">PyTorch</a>，并将它开源了。用这个库你可以使用Torch使用的低层的库，但是你可以使用Python而不是Lua。</p>\n<p>PyTorch对查错的支持很好，这是因为Theano和TensorFlow使用符号计算而PyTorch则不是。使用符号计算就表明在一行代码被解释的时候，一个操作（x+y）并不会被执行，在那之前，它必须先被编译（解释成CUDA或者C语言）。这就让用Theano和TensorFlow的时候很难查错，因为很难把报错跟当前的代码联系起来。这样做有它的好处，不过查错简单不在其中。</p>\n<p>如果你想开始学PyTorch，<a href=\"http://pytorch.org/tutorials/\" target=\"_blank\" rel=\"noopener noreferrer\">官方文档</a>适合初学者也会包含有难度的内容。</p>\n<h2>机器学习的第一步？</h2>\n<p>你讲了这么多机器学习的包，我应该用哪一个？我怎样比较它们？我从哪里开始？</p>\n<p>你可以试用我们面向初学者的平台Ape Advice™，就不用烦细节的问题了。如果你完全没有接触过机器学习，从<a href=\"http://scikit-learn.org/stable/tutorial/basic/tutorial.html\" target=\"_blank\" rel=\"noopener noreferrer\">scikit-learn</a>开始。你可以了解标记，训练和测试是怎样工作的，以及一个模型是如何被建立的。</p>\n<p>如果你想试试深度学习，从<a href=\"https://elitedatascience.com/keras-tutorial-deep-learning-in-python\" target=\"_blank\" rel=\"noopener noreferrer\"> Keras</a>开始，毕竟这是大家公认的最简单的框架。你可以先试试，找找感觉。当你有点经验之后，你可以开始考虑你最需要的是什么：速度，不同的API，或者别的什么，之后你就能更好地决定了。</p>\n<p>目前有<a href=\"https://github.com/zer0n/deepframeworks/blob/master/README.md\">海量的文章</a>比较Theano，Torch和TensorFlow。没有人能说哪个最好。你要记住的是所有包都支持很多东西，而且也在不断改进，想相互比较它们也越来越难。六个月前的标准有可能已经过时了，一年前的评价说框架X没有Y功能也不一定还有效。</p>\n<p>最后，如果你想用NLP，可以试试<a href=\"https://monkeylearn.com/\" target=\"_blank\" rel=\"noopener noreferrer\">MonkeyLearn</a>!我们的这个平台所提供的用户界面让建造模型，训练模型和改进NLP模型都非常容易试下。你可以用事先训练好的模型处理常见问题（意见挖掘，话题探测或者提取关键字），也可以为你特有的问题设计一个新的算法。你不需要担心底层实现或者发布你的模型，我们可扩展的云系统会帮你完成这些。你可以<a href=\"https://app.monkeylearn.com/accounts/register/\" target=\"_blank\" rel=\"noopener noreferrer\">免费注册</a>，马上开始试用我们超棒的API。</p>\n<h2>想知道更多？</h2>\n<p>关于机器学习的网络资源很多！下面列举一些：</p>\n<ul>\n<li>如果你想看看代码， 这里有 <a href=\"http://nbviewer.jupyter.org/github/rhiever/Data-Analysis-and-Machine-Learning-Projects/blob/master/example-data-science-notebook/Example%20Machine%20Learning%20Notebook.ipynb\" target=\"_blank\" rel=\"noopener noreferrer\">一个机器学习详细范例的Jupyter Notebook</a></li>\n<li>如果你想知道更多机器学习的概念，可以看<a href=\"https://blog.monkeylearn.com/a-gentle-guide-to-machine-learning/\" target=\"_blank\" rel=\"noopener noreferrer\">我们的机器学习入门指南</a></li>\n<li>如果你要认真学机器学习，你可以从<a href=\"https://www.coursera.org/learn/machine-learning\" target=\"_blank\" rel=\"noopener noreferrer\">Andrew Ng’s Stanford CS229 on Coursera</a>开始；如果你要找关于深度学习的网络课程，可以看看 <a href=\"http://course.fast.ai/\" target=\"_blank\" rel=\"noopener noreferrer\">fast.ai</a>.</li>\n</ul>\n<h2>结语</h2>\n<p>这篇关于用Python库做机器学习的简介就到此为止。我想强调的是不要被细节吓住了，放手尝试。让你的好奇心指导你前进，不要害怕进行不同的实验。</p>\n<div class=\"about-author\">如果你知道我没有提到的Python库，可以发在评论里面！</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/2ec965670e006b5d53c221a7cdcf0108.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/a5e36df34a1aea088f06fb503c7ce93d.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88705\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88705votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88705\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 21 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 7 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui\">小米云豆粥</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/5bfa690c5bc8a2dc2344cffdebf5f50b.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            数据科学进修中，Python小码农。不用QQ，有事站内信联系。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/buntamarui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/buntamarui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 32</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/ammie/\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/bchen4\"><i class=\"fa fa-github\"></i></a> <a title=\"Linked主页\" target=\"_blank\" href=\"https://www.linkedin.com/\"><i class=\"fa fa-linkedin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "D:/code/scrapy/Tencent\\images\\工具与框架,框架,,机器学习\\使用 Python 开始机器学习_scrapy.jpg"},
]